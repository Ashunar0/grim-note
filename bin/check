#!/usr/bin/env bash

set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"

echo "==> Running Rails tests"
(
  cd "${ROOT_DIR}/backend"
  bundle _2.3.27_ config set --local path 'vendor/bundle'
  if ! bundle _2.3.27_ check >/dev/null 2>&1; then
    bundle _2.3.27_ install
  fi
  bundle _2.3.27_ exec rails test
  bundle _2.3.27_ exec rubocop
)

echo "==> Running frontend lint"
(
  cd "${ROOT_DIR}/frontend"
  if [ ! -d node_modules ]; then
    if [ -f package-lock.json ]; then
      npm ci
    else
      npm install
    fi
  fi
  npm run lint
)

echo "==> Quality checks completed successfully"
