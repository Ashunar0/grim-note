# CODEX.md

## 🎯 目的

このファイルは、**Codex（AI コードアシスタント）** に対して、
本プロジェクトで遵守すべき **コーディング規約・出力スタイル・品質基準** を明示するためのガイドラインです。

---

## 🗣️ 出力スタイル

- 回答は **日本語で説明**＋**英語でコード**。
- コードブロックには必ず言語指定を行う（例：`ruby、`js）。
- 不要なコメントや説明を省き、**実用的で最小限の出力**を目指す。
- ファイル構造がある場合はツリー形式で示す。

---

## 💾 コミットメッセージ規約

### フォーマット

```
<type>: <短く具体的な説明>

[詳細な変更内容 (任意)]
```

### type 一覧

| type     | 用途                             |
| -------- | -------------------------------- |
| feat     | 新機能の追加                     |
| fix      | バグ修正                         |
| refactor | 機能に影響しないリファクタリング |
| docs     | ドキュメント変更                 |
| test     | テストの追加・修正               |
| style    | コード整形・Lint 修正            |
| chore    | 依存関係や CI 設定などの更新     |

#### 例

```
feat: 書籍投稿APIを実装

- POST /api/books エンドポイントを追加
- Strong Parametersを導入
```

---

## 💡 コーディングルール

### 一般

- Lint に準拠する（Rails → Rubocop、React → ESLint + Prettier）。
- 変数名・関数名は**意味が明確で短い**ものを使う。
- **DRY 原則**（Don't Repeat Yourself）を意識。
- コメントは「なぜそうしたか」を書く。

---

### Ruby on Rails

- API モードの場合、`--api` オプションで作成。
- ビジネスロジックは Controller に置かず、Service 層・Model 層へ分離。
- Strong Parameters を必ず使用。
- ActiveRecord メソッドを優先、SQL 直書きは禁止。
- エラーハンドリングは `rescue_from` で共通化。
- JSON レスポンスは `Jbuilder` or `Serializer` を使用。

---

### JavaScript / TypeScript

- React Hooks の命名規則に従う。(useXxx)
- モジュールは ES Modules 形式で書く。
- 定数は `const`、再代入が必要な変数は `let`。
- 非同期処理は `async/await` に統一。
- React コンポーネントは関数コンポーネント＋ Hooks ベース。
- TypeScript の場合、明示的な型定義を行う（暗黙 any 禁止）。
- Props の型定義は必ず行う。

---

## 📘 ドキュメント生成ルール

- Markdown 形式（`.md`）で出力。

- 以下の構成を基本テンプレートとする：

  1. 概要
  2. 前提・目的
  3. 実装内容
  4. 注意点 / 補足

- 必要に応じて `docs/` 配下の設計書を参照：

  - `/docs/architecture.md`
  - `/docs/api-design.md`
  - `/docs/frontend-style.md`
  - `/docs/backend-style.md`

---

## 🧠 Codex に意識してほしい観点

- 適宜 docs/配下の設計ファイルを参照すること
- 冗長な処理・ネストを避ける。
- パフォーマンスを意識（N+1 クエリ防止など）。
- セキュリティを考慮（XSS, CSRF, SQL Injection）。
- テスト容易性を意識した構造にする。
- 外部キー・バリデーションの整合性を確認。
- 依存ライブラリの過剰使用を避け、**標準 API で書けるものは標準で書く。**
- 「動くコード」よりも「チームで保守できるコード」を優先。

---

## 🚫 禁止事項

- API キー、環境変数、個人情報を出力しない。
- ランダムに生成したダミー値を本番データとして扱わない。
- 非推奨メソッドやセキュリティリスクのある記法を使用しない。
- コードの「魔法の一行」的トリックは禁止。

---

## ✅ 最後に

Codex は、**自動生成ではなく“共同開発者”**として機能すること。
可読性・安全性・拡張性の 3 軸を常に意識してコードを生成すること。

---
