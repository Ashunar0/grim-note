**ファイルパス**: `docs/tests/test_14_quality-gates-and-ci-setup.md`

# テストケース: 品質ゲートと自動化整備

対象 Issue: #14  
関連ドキュメント:

- [要件定義書](../01_requirements.md)
- [アーキテクチャ](../02_architecture.md)
- [実装ロードマップ](../implementation-roadmap.md)

---

## 概要

- 目的: Lint/Test を実行する CI ワークフローとローカル統合スクリプトが整備され、主要 API/フロントのスモークテストが追加され、ドキュメントに手順が明記されているか検証する。
- スコープ: GitHub Actions ワークフロー、`bin/check` などの統合コマンド、Rails/Next.js テスト追加、README/AGENTS 更新。
- 対象: `.github/workflows/*.yml`、スクリプト、ドキュメント。

## 前提条件

- 環境: GitHub Actions (Ubuntu Latest)、ローカル Ruby 3.1.6 / Node 20。
- 仮想環境で DB セットアップが可能（SQLite/ PostgreSQL）。CI 対応 DB を定義する。
- リポジトリに動作確認用のシンプルなテストが既に存在。

## AC トレーサビリティ

| AC 番号 | 内容（要約）                                                                   | 検証ケース ID                    |
| ------- | ------------------------------------------------------------------------------ | -------------------------------- |
| AC-1    | GitHub Actions で Rails test・rubocop・npm lint を実行するワークフローが追加   | TEST-14-01, TEST-14-02           |
| AC-2    | ローカル統合スクリプト（例: `bin/check`）で lint/test をまとめて実行できる     | TEST-14-03                       |
| AC-3    | Rails リクエストテスト + フロント smoke テストが追加される                     | TEST-14-04                       |
| AC-4    | README / AGENTS に品質チェックの手順が追記                                     | TEST-14-05                       |

## テスト観点一覧

- CI: ワークフロー構文、ジョブ成功、並列実行。
- ローカル: スクリプト引数、終了ステータス、ログ整形。
- テスト資産: 最低限の API/フロントテストが存在し、継続的に実行される。
- ドキュメント: 手順の明確さ。

## テストケース（詳細）

| ID         | 観点               | 目的                                                                   | 前提                                    | 手順                                                                                                                                              | 期待結果                                                                                           | AC   |
| ---------- | ------------------ | ---------------------------------------------------------------------- | --------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------- | ---- |
| TEST-14-01 | ワークフロー構文   | GitHub Actions ワークフローファイルが正しい構文であるか確認            | `.github/workflows/ci.yml` 作成済み      | 1) `act` などで dry-run するか、`yamllint` を通す                                                                                                  | 構文エラーなし                                                                                       | AC-1 |
| TEST-14-02 | ワークフロー実行   | CI 上で Rails test + rubocop + npm lint が成功するか確認               | GitHub Actions 実行権限がある            | 1) Pull Request を作成 2) Actions タブでジョブ成功を確認                                                                                          | 全ジョブ成功、結果を PR に添付                                                                       | AC-1 |
| TEST-14-03 | 統合スクリプト     | `bin/check`（または同等コマンド）がローカルで lint/test をまとめて実行 | スクリプト作成済み                       | 1) `bin/check` 実行 2) 成功/失敗時のステータスコードとログを確認                                                                                | 0 終了で全タスク成功。失敗時には終了コード≠0                                                        | AC-2 |
| TEST-14-04 | テスト資産         | 追加されたリクエストテストとフロント smoke テストが実行されるか確認    | それぞれのテストファイルが作成済み       | 1) `bin/rails test TEST=test/requests/...` 2) `npm run test -- --runTestsByPath ...`                                                             | 新規テストが成功し、CI に組み込まれている                                                           | AC-3 |
| TEST-14-05 | ドキュメント更新   | README/AGENTS に品質チェック手順が追記されているか確認                 | ドキュメント更新済み                     | 1) README と AGENTS を確認 2) `bin/check` や Actions 実行方法が記載                                       | 手順・前提・結果確認方法が明記されている                                                           | AC-4 |

## データセット（例）

- サンプル CI 設定: Ruby 3.1.6、Node 20、`npm ci` 使用。
- テスト: Rails 側は `/api/v1` 向けリクエストテスト、フロントは Playwright or RTL の smoke。

## 実行コマンド例

```bash
bin/check
bin/rails test
npm run lint
npm run test -- --runTestsByPath src/__tests__/smoke.test.tsx
```

## 成果物

- CI 実行結果 URL、ローカル実行ログを「検証結果」に記録。

## 検証結果（記録用）

| 実施日     | 担当 | 結果 | メモ |
| ---------- | ---- | ---- | ---- |
| YYYY/MM/DD |      | ✅/❌ |      |

## 要確認事項（未確定・オープン）

- CI 上でのデータベース（SQLite or PostgreSQL）選択。
- フロント smoke テストを Playwright/RTL どちらで実装するか。

---
