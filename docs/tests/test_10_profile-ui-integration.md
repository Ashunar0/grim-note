**ファイルパス**: `docs/tests/test_10_profile-ui-integration.md`

# テストケース: プロフィール UI の API 連動

対象 Issue: #10  
関連ドキュメント:

- [要件定義書](../01_requirements.md)
- [サイトマップ](../05_sitemap.md)
- [API 設計](../04_api.md)

---

## 概要

- 目的: プロフィール表示・編集 UI が API と連携し、閲覧/編集/リダイレクト条件を満たすか検証する。
- スコープ: `/users/:id` のプロフィール画面、`ProfileHeader` 表示制御、`/users/:id/edit` のフォーム、権限チェック。
- 対象: Next.js ページ、hook、API クライアント。

## 前提条件

- 環境: Node 20 / Next.js 13。
- API: Issue #9 のプロフィール API が稼働。
- 認証: Issue #4 の認証コンテキストが利用可能。

## AC トレーサビリティ

| AC 番号 | 内容（要約）                                                                     | 検証ケース ID                |
| ------- | -------------------------------------------------------------------------------- | ---------------------------- |
| AC-1    | `/users/:id` が API レスポンスを描画し、空状態も表示                             | TEST-10-01                   |
| AC-2    | `ProfileHeader` が `is_self` で編集ボタン表示を切り替える                        | TEST-10-02                   |
| AC-3    | `/users/:id/edit` が初期値取得→PATCH 成功後にプロフィールへ戻る                  | TEST-10-03                   |
| AC-4    | 本人以外が編集 URL へアクセスするとトップ/ログインへリダイレクト                 | TEST-10-04                   |

## テスト観点一覧

- ポジティブ: プロフィール表示、編集成功。
- ネガティブ: 投稿0件表示、APIエラー、他人編集アクセス。
- UX: ローディング/エラー表示、フォームバリデーション。
- ルーティング: 認証ガード、戻り遷移。

## テストケース（詳細）

| ID         | 観点               | 目的                                                                     | 前提                                       | 手順                                                                                                                                                  | 期待結果                                                                                       | AC   |
| ---------- | ------------------ | ------------------------------------------------------------------------ | ------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------ | ---- |
| TEST-10-01 | プロフィール表示   | API 応答が UI に反映され、投稿が無い場合の空表示も確認                   | MSW で API 応答（投稿あり/なし）をモック    | 1) `/users/:id` 表示 2) プロフィール情報・投稿カードを確認 3) 投稿ゼロ応答で再度確認                                                                   | ユーザー情報・投稿一覧が表示、投稿ゼロ時は「まだ投稿がありません」などの空表示                      | AC-1 |
| TEST-10-02 | 編集ボタン制御     | `is_self` true/false で編集ボタン表示切り替え                            | ログインユーザー/他ユーザーでアクセス       | 1) 自分のプロフィール閲覧→編集ボタン表示確認 2) 他ユーザープロフィール→ボタン非表示確認                                                              | 条件に応じて編集ボタンが表示/非表示                                                            | AC-2 |
| TEST-10-03 | 編集フォーム       | 編集ページが初期値を読み込み PATCH 成功後にプロフィールへ戻るか確認    | ログイン済み、MSW で PATCH 成功応答         | 1) `/users/:id/edit` へアクセス 2) 初期値がフォームにセット 3) 更新送信→成功後の遷移を確認                                                            | 200 応答後 `/users/:id` へ遷移し最新情報を表示                                                  | AC-3 |
| TEST-10-04 | 権限制御           | 本人以外の編集 URL へアクセスするとリダイレクトされるか確認             | 他ユーザーでログイン                       | 1) `/users/:id/edit`（他人）へ直接アクセス 2) リダイレクト先を確認                                                                                    | `/` または `/login` へ遷移し、編集ページは表示されない                                         | AC-4 |

## データセット（例）

- プロフィール応答モック: `is_self`/`is_following` の両パターン。
- 投稿一覧: 2件程度のサンプル。
- フォローボタン表示は Issue #12 でテスト予定。

## 実行コマンド例

```bash
npm run test        # React Testing Library
npm run test:e2e    # Playwright
npm run lint
```

## 成果物

- テスト結果を「検証結果」に記録。必要であれば UI スクリーンショットを添付。

## 検証結果（記録用）

| 実施日     | 担当 | 結果 | メモ |
| ---------- | ---- | ---- | ---- |
| YYYY/MM/DD |      | ✅/❌ |      |

## 要確認事項（未確定・オープン）

- 編集禁止時のリダイレクト先（トップ or ログイン）の最終仕様。
- アイコン変更ボタンの挙動（アップロード未対応のため disable か要確認）。

---
