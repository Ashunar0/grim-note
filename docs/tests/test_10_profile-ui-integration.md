**ファイルパス**: `docs/tests/test_10_profile-ui-integration.md`

# テストケース: プロフィール UI の API 連動

対象 Issue: #10  
関連ドキュメント:

- [要件定義書](../01_requirements.md)
- [サイトマップ](../05_sitemap.md)
- [API 設計](../04_api.md)

---

## 概要

- 目的: プロフィール表示・編集 UI が API と連携し、閲覧/編集/リダイレクト条件を満たすか検証する。
- スコープ: `/users/:id` のプロフィール画面、`ProfileHeader` 表示制御、`/users/:id/edit` のフォーム、権限チェック。
- 対象: Next.js ページ、hook、API クライアント。

## 前提条件

- 環境: Node 20 / Next.js 13。
- API: Issue #9 のプロフィール API が稼働。
- 認証: Issue #4 の認証コンテキストが利用可能。

## AC トレーサビリティ

| AC 番号 | 内容（要約）                                                                     | 検証ケース ID                          |
| ------- | -------------------------------------------------------------------------------- | -------------------------------------- |
| AC-1    | `/users/:id` が API レスポンスを描画し、空状態も表示                             | TEST-10-01, TEST-10-02                 |
| AC-2    | `ProfileHeader` が `is_self` で編集ボタン表示を切り替える                        | TEST-10-03                             |
| AC-3    | `/users/:id/edit` が初期値取得→PATCH 成功後にプロフィールへ戻る                  | TEST-10-05, TEST-10-08, TEST-10-09     |
| AC-4    | 本人以外が編集 URL へアクセスするとトップ/ログインへリダイレクト                 | TEST-10-06, TEST-10-07                 |

## テスト観点一覧

- ポジティブ: プロフィール表示、編集成功。
- ネガティブ: 投稿0件表示、APIエラー、他人編集アクセス。
- UX: ローディング/エラー表示、フォームバリデーション。
- ルーティング: 認証ガード、戻り遷移。

## テストケース（詳細）

| ID         | 観点               | 目的                                                                     | 前提                                       | 手順                                                                                                                                                  | 期待結果                                                                                       | AC   |
| ---------- | ------------------ | ------------------------------------------------------------------------ | ------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------ | ---- |
| TEST-10-01 | プロフィール表示   | API 応答が UI に反映されるか確認                                         | 投稿ありのプロフィール応答をモック          | 1) `/users/:id` 表示 2) プロフィール情報・投稿カードを確認                                                                                               | ユーザー情報・投稿一覧・編集導線が表示                                                          | AC-1 |
| TEST-10-02 | 投稿ゼロ表示       | 投稿が無い場合に空状態が表示されるか確認                                 | 投稿 0 件の応答をモック                    | 1) `/users/:id` 表示 2) 空表示文言を確認                                                                                                                 | 「まだ投稿がありません」と表示                                                                  | AC-1 |
| TEST-10-03 | 編集ボタン制御     | `is_self` true/false で編集ボタン/フォローボタンを切り替え                | ログインユーザー/他ユーザーでアクセス       | 1) 自分のプロフィール閲覧→編集ボタン 2) 他ユーザー閲覧→フォロー中ボタン                                                                               | 条件に応じて導線が切り替わる                                                                    | AC-2 |
| TEST-10-04 | 未ログイン表示     | 未ログイン時にログイン導線が表示されるか確認                             | API が 401 を返すようモック                 | 1) `/users/:id` 表示 2) エラーメッセージとログインリンクを確認                                                                                           | 「ログインが必要です」メッセージとログイン導線                                                  | -    |
| TEST-10-05 | 編集フォーム成功   | 編集ページが初期値を読み込み PATCH 成功後にプロフィールへ戻るか確認    | ログイン済み、PATCH 成功応答をモック        | 1) `/users/:id/edit` へアクセス 2) 初期値セット 3) 更新送信→成功後の遷移を確認                                                                          | 200 応答後 `/users/:id` へ遷移し最新情報を表示                                                  | AC-3 |
| TEST-10-06 | 他人編集リダイレクト | 本人以外の編集 URL へアクセスすると詳細ページへリダイレクトされるか確認 | 他ユーザーのプロフィール応答をモック        | 1) `/users/:id/edit`（他人）へ直接アクセス 2) リダイレクト先を確認                                                                                      | `/users/:id` へリダイレクトし編集フォームは表示されない                                        | AC-4 |
| TEST-10-07 | 未ログイン編集     | 未ログイン時に編集ページへアクセスするとログインへリダイレクトされるか確認 | API が 401 を返すようモック                 | 1) `/users/:id/edit` へアクセス 2) リダイレクト先を確認                                                                                                  | `/login` へリダイレクト                                                                          | AC-4 |
| TEST-10-08 | バリデーション     | アイコン URL が不正な場合にエラーが表示されるか確認                       | PATCH 422 応答をモック                      | 1) `/users/:id/edit` へアクセス 2) 不正 URL で送信                                                                                                        | 「アイコンURLが不正です」などのエラー表示                                                       | AC-3 |
| TEST-10-09 | アイコン削除       | アイコン URL を空で送信した場合に null として保存されるか確認              | PATCH 成功応答（icon_url: null）をモック     | 1) `/users/:id/edit` でアイコン URL を削除 2) 保存→更新リクエストの payload とリダイレクトを確認                                                       | リクエスト body の `icon_url` が null、更新後 `/users/:id` へ遷移                               | AC-3 |

## データセット（例）

- プロフィール応答モック: `is_self`/`is_following` の両パターン。
- 投稿一覧: 2件程度のサンプル。
- フォローボタン表示は Issue #12 でテスト予定。

## 実行コマンド例

```bash
npm run test        # React Testing Library
npm run test:e2e    # Playwright
npm run lint
```

## 成果物

- テスト結果を「検証結果」に記録。必要であれば UI スクリーンショットを添付。

## 検証結果（記録用）

| 実施日     | 担当 | 結果 | メモ |
| ---------- | ---- | ---- | ---- |
| 2025/10/28 | codex | ✅ | `npm run test -- --run` |

## 要確認事項（未確定・オープン）

- 編集禁止時のリダイレクト先（トップ or ログイン）の最終仕様。
- アイコン変更ボタンの挙動（アップロード未対応のため disable か要確認）。

---
